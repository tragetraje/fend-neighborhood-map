YUI.add("hermes-lang-share-modal",function(e,t){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],SHARE_PHOTOS:["Share photos"],SHARE_VIDEO:["Share Video"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_ALBUM:["Share album"],SHARE_FAVORITES:["Share favorites"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],EMAIL_BODY_PHOTOS:["${username}"," shared ",{type:"plural",valueName:"count",options:{one:"${#} photos",other:"${#} photo"}}," with you!"],EMAIL_BODY_ALBUM:["${username}"," shared an album with you!"],EMAIL_BODY_PHOTOSTREAM:["${username}"," shared their photostream with you!"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_VIDEO_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} video to:",other:"Share ${#} videos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],EMBED_SIMPLE:["Embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked Friends"],SHARE_FAMILY:["Include photos marked Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked Family & Friends"],SHARE_FRIENDS_AND_FAMILY:["Include photos marked Friends & Family"],SHARE_PRIVATE:["All photos - public and private"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"],PHOTO_PRIVATE_MESSAGE:['This photo is private. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FRIENDS_MESSAGE:['This photo is only visible to friends. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_MESSAGE:['This photo is only visible to family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_FRIENDS_MESSAGE:['This photo is only visible to friends & family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_CAMERAROLL_MESSAGE:["All photos being shared will be viewable by the recipient(s) regardless of privacy level."],GUESTPASS_CREATION_FAILURE:["There was an error generating the share link.  Please try again."],CONTACT_SEARCH_ERROR:["There was an error when adding a recipient. Please try again."],FLICKR_SHARE_ERROR:["There was an error sharing on Flickr. Please try again."],FLICKR_SHARE_SUCCESS:["Your items have been shared!"],FLICKR_SHARE_SUCCESS_TITLE:["Success"],CLICK_GENERATE_LINK:["Click to generate a shareable link"],FLICKR_SHARE:["Share"],COPY_MAC:["Press Command+C to copy this link when selected"],COPY_PC:["Press Ctrl+C to copy this link when selected"],CANCEL_SHARE_BECAUSE_ERROR:[{type:"plural",valueName:"photoCount",options:{one:"This photo cannot be shared. Please try again later.",other:"These photos cannot be shared. Please try again later."}}],LINK_PRIVACY_REMINDER:[{type:"plural",
valueName:"photoCount",options:{one:"The private photo in this selection will remain private. Only people you share this link with will be able to view it.",other:"The private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],PHOTO_PAGE_PRIVACY_WARNING:["This photo will remain private. Only people you share this link with will be able to view it."],CAMERAROLL_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"This photo will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],ALBUM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this album will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this album will remain private. Only people you share this link with will be able to view them."}}],PHOTOSTREAM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in your photostream will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in your photostream will remain private. Only people you share this link with will be able to view them."}}],CANCEL_SHARE_BECAUSE_RESTRICTED:["Sorry! You can't share restricted photos."],NO_SHAREABLE_ITEMS:["There are no items available to share."],EMBEDR_OPTION_HEADER:["Header"],EMBEDR_OPTION_FOOTER:["Footer"],EMBEDR_OPTION_TRUNCATE:["Truncate"],EMBEDR_OPTION_SLIDESHOW:["Slideshow"],EMBEDR_CHANGE_PRIVACY_WARNING:['You\'re trying to embed one of your private photos! If you still want to embed this photo, you can make it public by selecting "Public" from the privacy menu at the bottom this page.'],ALBUM_DOWNLOAD_ACCESS_YOU:[{type:"plural",valueName:"photoCount",options:{one:"Only you will be able to download this photo.",other:"Only you will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FF:[{type:"plural",valueName:"photoCount",options:{one:"Only your friends and family will be able to download this photo.",other:"Only your friends and family will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FOLLOWING:[{type:"plural",valueName:"photoCount",options:{one:"Only people you follow will be able to download this photo.",other:"Only people you follow will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_MEMBERS:[{type:"plural",valueName:"photoCount",options:{one:"Only Flickr members will be able to download this photo.",other:"Only Flickr members will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_EVERYONE:[{type:"plural",valueName:"photoCount",options:{one:"Everyone will be able to download this photo.",other:"Everyone will be able to download these photos."}}],CHANGE_DOWNLOAD_PREF:["(<a href='","${url}","'>Change your download preferences</a>)"],EMBED_WITH_GUESTPASS:["Embed this photo with a guestpass"]})},"@VERSION@",{requires:["intl"]});
YUI.add("fluid-share-view",function(e,t){var n=require("lib/flog")(t),r="signedOutEmailSharing",i={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};i.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(i.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},"use strict",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"",this.appContext.lang.toLowerCase()==="en-us"?this.isEnglishLang=!0:this.isEnglishLang=!1,this.removeOverlayOnClose=e.removeOverlayOnClose,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var t=this.get("container"),n="."+i.css.shareBtn,r=t.one(n);return r&&(this.isEnglish||!this.isDisabled)&&this.registerEventHandler(t.delegate("click",function(t){t.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(t){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:t})}.bind(this)),this.prepareModal(r)},n,this)),this},prepareModal:function(t){if(!this.shouldCancelModal())return this.getItemCount().then(function(n){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(t,n,this.removeOverlayOnClose))}.bind(this)).catch(function(e){n.error({err:e})})},showModal:function(t,n,s){var o=this,u=this.getIsMine(),a=i.css.networkClasses,f=o.getTitleIntlKey(),l={intlName:"share-modal."+f},c;if(f==="SHARE_PHOTOS_TO"||f==="SHARE_VIDEO_TO")l.count=n;return c=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:o.intlMessage(l),classList:"modal-restyle "+o.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:o.appContext,networkClasses:a,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:u,shareItemCount:n,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:s}),c.registerEventHandler(c.get("container").delegate("click",function(e){e.preventDefault(),e.target.ancestor("."+a.facebook.className,!0)?o.preProcessShare(o.prepareFacebookShareParameters,o.shareToFacebook):e.target.ancestor("."+a.twitter.className,!0)?o.preProcessShare(o.prepareTwitterShareParameters,o.shareToTwitter):e.target.ancestor("."+a.tumblr.className,!0)?o.preProcessShare(o.prepareTumblrShareParameters,o.shareToTumblr):e.target.ancestor("."+a.pinterest.className,!0)&&o.preProcessShare(o.preparePinterestShareParameters,o.shareToPinterest)},".share-link.sharing-type-enabled")),c.on("share-by-email",function(t){var n=e.merge(o.prepareFlickrShareParameters(),t);o.shareToFlickr(c,n)}),c.on("done-sharing",function(t){c.close(),o.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),c.on("request-guestpass",function(e,t,n){o.requestGuestpass(c,t,n,!0)}),c.on("generate-link",function(){o.generateLink().then(function(e){c.fire("parentViewEvent","generated-link",e)})}),c.on("activated",function(){c.get("subview").cancel&&c.get("container").one(".title").setHTML(o.intlMessage({intlName:"common.OOPS"})),c.reposition()}),c.on("guestpass-required",function(){o.guestpassRequired=!0}),c.on("confirm-sign-in",function(){c.close();var t=new e.Views.FluidModal({appContext:o.appContext,title:o.intlMessage({intlName:"common.OOPS"}),message:o.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:o.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});t.on("actionClick",function(){e.StorageHelper.setItem(r,new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){t.show()},10)}),c.on("close",function(){o.fire("sharePresentationClose"),o.guestPassURLs={},e.rapidTracker.beacon(o.name,"shareModalCancelClick")}),c.on("closeAll",function(){o.fire("sharePresentationClose"),c.close(),o.guestPassURLs={}}),c.show(),this.sharePresentation=c,c},showErrorModal:function(){var t=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.intlMessage({intlName:"common.OOPS"}),message:this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"})});return t.show(),t},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters
:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(t,r){if(!t.url)return n.error("Error sharing to Facebook.  Missing url.");var s,o=encodeURIComponent(e.url(t.url)),u=this.guestPassURLs,a,f,l,c;this.guestpassRequired&&u&&(a=u[100],f=u["010"],l=u[110],c=u[111],f&&(o=f),a&&(o=a),l&&(o=l),c&&(o=c)),s=i.networks.facebook.shareUrl+o,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:t.count||1}),r?r.location.replace(s):r=this.createSharePopup(s),this.trackShareCompletion(r)},shareToTwitter:function(t,r){if(typeof t.url=="undefined"||t.url===null)return n.error("Error sharing to Twitter.  Missing url.");if(!t.title)return n.error("Error sharing to Twitter.  Missing title.");var s,o,u=t.title,a,f;o=t.url===""?"":encodeURIComponent(t.url),f=u+" "+i.networks.twitter.hashTags,f.length+o.length>140&&(a=f.length+o.length-140,f=u.substring(0,u.length-(a+1))+"\u2026"+" "+i.networks.twitter.hashTags),s=i.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(f)).replace("{{linkToShare}}",o),r?r.location.replace(s):r=this.createSharePopup(s),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:t.count||1}),this.trackShareCompletion(r)},shareToTumblr:function(t,r){if(!t.title)return n.error("Error sharing to Tumblr.  Missing title.");if(!t.displayPhotoURL)return n.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var s,o=t.title,u,a,f=t.tags||"",l=t.description,c,h=e.URLHelper.addProtocolToURL(t.displayPhotoURL),p,d=t.isPhotoPage,v=i.networks.tumblr.shareUrl;if(!d||!this.appContext.flipper.isFlipped("enable-tumblr-embed-share"))v+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}";t.authorURL&&(u=e.url(t.authorURL)),t.ownerName&&(a=t.ownerName),t.url.indexOf("https://")===0?c=t.url:t.url.indexOf("//")===0?c=e.URLHelper.addProtocolToURL(t.url):c=e.url(t.url),s=this.templates("fluid-share-tumblr-post")({title:o,ownerURL:u,ownerName:a,description:l,linkToShare:c}),p=v.replace("{{displayPhotoURL}}",encodeURIComponent(h)).replace("{{tumblrCaption}}",encodeURIComponent(s)).replace(/{{linkToShare}}/g,encodeURIComponent(c)).replace("{{tags}}",encodeURIComponent(f)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:t.count||1}),r?r.location.replace(p):r=this.createSharePopup(p,!0)},shareToPinterest:function(t,r){if(!t.title)return n.error("Error sharing to Pinterest.  Missing title.");if(!t.displayPhotoURL)return n.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!t.url)return n.error("Error sharing to Pinterest.  Missing url.");if(!t.shortURL)return n.error("Error sharing to Pinterest.  Missing shortURL.");var s,o,u=e.Handlebars.helpers.stripTags(t.description)||"",a=t.shortURL,f=t.title,l=e.URLHelper.addProtocolToURL(t.displayPhotoURL),c;o=encodeURIComponent(e.url(t.url)),u.trim()!==""?c=a+" | "+f+" | "+u:c=a+" | "+f,l=l.replace("https:","http:"),o=o.replace("https:","http:"),s=i.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(l)).replace("{{description}}",encodeURIComponent(c)).replace("{{linkToShare}}",o),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:t.count||1}),r?r.location.replace(s):r=this.createSharePopup(s,!0)},shareToGooglePlus:function(t,r){if(!t.url)return n.error("Error sharing to GooglePlus.  Missing url.");var s,o;o=encodeURIComponent(e.url(t.url)),s=i.networks.googlePlus.shareUrl+o,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:t.count||1}),r?r.location.replace(s):r=this.createSharePopup(s)},shareToFlickr:function(t,s){if(!s.recipients)return n.error("Error sharing to Flickr.  Missing recipients.");if(!s.url)return n.error("Error sharing to Flickr.  Missing url.");if(!s.modelName)return n.error("Error sharing to Flickr.  Missing modelName.");if(!s.modelId)return n.error("Error sharing to Flickr.  Missing modelId.");var o,u=s.modelName,a=s.modelId,f=s.recipients,l=s.message||"",c=s.guestpassStr||"public",h={},p=[],d=[],v,m;o=encodeURIComponent(e.url(s.url)),u==="share_code"?h[u]=a:h[u+"_id"]=a,h.service_type_id="130",h.owner_id=this.appContext.getViewer().nsid;if(c!=="public"){if(c==="friends"||c==="family_and_friends")h.guestpass_friends="1";if(c==="family"||c==="family_and_friends")h.guestpass_family="1";c==="private"&&(h.guestpass_private="1",h.guestpass_friends="1",h.guestpass_family="1")}for(v in f)m=f[v]||{},m.email?p.push(m.email):m.nsid&&d.push(m.nsid);h.to_flickr=d.join(","),h.to_email=p.join(","),h.message=e.flutil.escapeInput(l),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:s.count||1,flkcnt:d.length,emailcnt:p.length});var g=e.StorageHelper.getItem(r);if(g){var y;try{y=e.moment(g),y.isValid()&&(new e.moment).diff(y,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:s.count||1}),e.StorageHelper.remove(r))}catch(b){}}if(!i.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(i.networks.flickr.apiCall,h).then
(function(){t&&t.fire("parentViewEvent","flickr-share-success")},function(e){t&&t.fire("parentViewEvent","flickr-share-error")})},generateLink:function(){var t=this;return this.onBeforeShare().then(function(e){return e},function(n){t.sharePresentation.fire("closeAll"),setTimeout(function(){var n=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"common.OOPS"}),message:t.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:t.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:t.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1});n.show()},10)})},preProcessShare:function(e,t){var r=this;if(this.onBeforeShare){var i=this.createSharePopup("",!0);try{i.document.body.innerHTML=r.templates("fluid-share-loading-state")()}catch(s){s.code===18&&(i.close(),i=this.createSharePopup("",!0),i.document.body.innerHTML=r.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(s){var o;try{o=e.call(r)}catch(u){n.error("Error getting share parameters",{err:u})}t.call(r,o,i)})}else{var o;try{o=e.call(r)}catch(u){n.error("Error getting share parameters",{err:u})}t.call(r,o)}},trackShareCompletion:function(t){var r=function(i){if(i.source===t)if(i.origin===e.url("/")&&i.data==="Window closed")n.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",r,!1);else if(i.origin===e.url("/")&&i.data.indexOf("share failure")===0)n.error("Got Facebook error",{data:i.data}),e.config.win.removeEventListener("message",r,!1);else if(i.origin==="https://twitter.com"&&i.data!=="__ready__")try{n.log("Tracking share completion",{data:i.data}),JSON.parse(i.data).params[0]==="tweet"&&i.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",r,!1))}catch(s){n.error("Error tracking share completion",{err:s})}};e.config.win.addEventListener("message",r,!1)},createSharePopup:function(t,n){var r={},i="",s="nativeShare"+(new Date).getTime();return r.width=n?950:640,r.height=480,r.top=(e.config.win.screen.height-r.height)/2,r.left=(e.config.win.screen.width-r.width)/2,e.Object.each(r,function(e,t){i+=t+"="+e+","}),i=i.slice(0,-1),e.config.win.open(t,s,i)},requestGuestpass:function(e,t,n,r){var i=this;this.guestPassURLs||(this.guestPassURLs={});if(this.guestPassURLs[t]){e.fire("parentViewEvent","guestpass-created",t,this.guestPassURLs[t]);return}this.appContext.callAPI("flickr.sharing.createGuestpass",n).then(function(n){if(!n||!n.guestpass||!n.guestpass.url)throw new Error("No guestpass returned");i.guestPassURLs[t]=n.guestpass.url,e.fire("parentViewEvent","guestpass-created",t,i.guestPassURLs[t])},function(s){r?i.requestGuestpass(e,t,n):e.fire("parentViewEvent","guestpass-failed",s)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});
YUI.add("fluid-share-photo-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId),this.appContext.getModel("photo-privacy-models",this.photoId),this.appContext.getModel("photo-engagement-models",this.photoId),this.appContext.getModel("photo-tags-models",this.photoId)]).then(function(e){return t.set("photoModel",e[0]),t.set("privacyModel",e[1]),t.set("engagementModel",e[2]),t.set("photoTagsModels",e[3]),t.set("tags",t.get("photoTagsModels").getValue("tags").toJSON()),t.get("photoModel").canVr().then(function(e){t.set("canVr",e)})})},buildContainer:function(){var e=this.get("photoModel").getValue("safetyLevel")===2;return this.get("photoModel").getValue("owner").id!==this.appContext.getViewer().nsid&&(e=e||!this.get("privacyModel").getValue("isPublic")),this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTO"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{url:e.URLHelper.getShortURL(t.getValue("id")),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner"),n=e.getLargestSize({excludeSizes:["o"]}).displayUrl,r=this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:r?e.getValue("url"):n,url:e.getValue("url"),isPhotoPage:!0,tags:this.get("tags").map(function(e){return e.tagRaw}).join(",")}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).displayUrl,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),modelName:"photo",modelId:e.getValue("id"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t=this.get("photoModel"),n=this.get("privacyModel"),r=this.get("engagementModel").getValue("canShare"),i;return r&&this.get("photoModel").getValue("isVideo")&&this.appContext.flipper.isFlipped("enable-embedr-video")?i=!0:i=r&&!this.get("photoModel").getValue("isVideo"),{url:this.appContext.flipper.isFlipped("enable-embedr-in-share")?e.config.win.location.pathname:t.getValue("url"),author:t.getValue("owner").getValue("displayname"),authorURL:t.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(t.getValue("id")),supportsEmbedr:i,supportsBBCode:r,sizes:t.getValue("sizes"),title:t.getValue("title")||this.intlMessage({intlName:"default.UNTITLED"}),secret:t.getValue("secret"),privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTO_PAGE_PRIVACY_WARNING"}),aspectRatio:t.getValue("aspectRatio"),isNonPublic:!n.getValue("isPublic")}},getTitleIntlKey:function(){var e=this.get("photoModel");return e.getValue("isVideo")?"SHARE_VIDEO_TO":"SHARE_PHOTOS_TO"},getGuestPassParams:function(){var e=this.get("privacyModel"),t=e.getValue("isVisibleByFriends"),n=e.getValue("isVisibleByFamily"),r=!e.getValue("isPublic"),i=this.get("photoModel"),s=i.getValue("isOwner"),o;return n&t?o=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_FRIENDS_MESSAGE"}):n?o=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_MESSAGE"}):t?o=this.intlMessage({intlName:"share-modal.PHOTO_FRIENDS_MESSAGE"}):r&&(o=this.intlMessage({intlName:"share-modal.PHOTO_PRIVATE_MESSAGE"})),{type:"photo",id:this.photoId,contentMarkedFriends:s&&t&&!n,contentMarkedFamily:s&&n&&!t,contentMarkedFriendFamily:s&&n&&t,contentMarkedPublic:!r&&!n&&!t,canSharePrivate:s&&r&&!n&&!t,showGuestPassDropdown:s&&r,multipleItems:!1,sharingEntirelyNotPublic:s&&r,nonPublicWarning:o}},getIsMine:function(){return this.get("photoModel").getValue("isOwner")},getSignedOutSharingPerms:function(){var e=this.get("engagementModel").getValue("canShare");return{facebook:{canShare:e},twitter:{canShare:e},tumblr:{canShare:e},pinterest:{canShare:e},flickr:{canShare:!1}}},onParentViewEvent:function(e,t){(t[0]==="enable-sharing"||t[0]==="disable-sharing")&&this.buildContainer()},shouldCancelModal:function(){var e=this.get("photoModel").getValue("safetyLevel")===2;return e&&this.buildContainer(),e},destructor:function(){this.fire("destroy")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","flutil"],langBundles:["models","default","share-modal"]});
YUI.add("hermes-lang-default",function(e,t){e.Intl.add("hermes/default","en-US",{UNTITLED:["Untitled"]})},"@VERSION@",{requires:["intl"]});
YUI.add("products-api-helper",function(e,t){function o(e,t){var n,r,i,s,o,u,a,f;return n=t.couponRegistry,r=t.discountRegistry,o=e.discount,e.id=o.couponCode,f=o.discountId,a={costDiscount:o.costDiscount,couponId:e.id,discountType:o.discountType,discountValue:o.discountValue,minPurchaseValue:o.minPurchaseValue,productEntity:o.productEntity},r.exists(f)?(r.setValues(f,a),u=r.proxy(f)):(a.id=f,u=r.add(a)),i={code:o.couponCode,subscriptionId:e.subscriptionId,discounts:[u],isValidCoupon:e.stat==="ok"},n.exists(e.id)?(n.setValues(e.id,i),s=n.proxy(e.id)):(i.id=e.id,s=n.add(i)),s}function u(e,t,n,r){var i,s,o,u,a,f,l,c,h,p;if(t&&!t.isValidCoupon)throw h=new Error(t.invalidReason),h.name="CouponInvalidError",h;return i=r.couponRegistry,s=r.discountRegistry,a=[],e.id=e.couponId,f=e.discounts.discount[0],p=f.discountId,c={costDiscount:f.costDiscount,couponId:e.id,discountType:f.discountType,discountValue:f.discountValue,minPurchaseValue:f.minPurchaseValue,productEntity:f.productEntity},s.exists(p)?(s.setValues(p,c),l=s.proxy(p)):(c.id=p,l=s.add(c)),a.push(l),o={code:e.code,orderId:n,discounts:a},t&&(o.isSingleUse=t.isSingleUse,o.isUserSpecific=t.isUserSpecific,o.isValidCoupon=t.isValidCoupon),i.exists(e.id)?(i.setValues(e.id,o),u=i.proxy(e.id)):(o.id=e.id,u=i.add(o)),u}function a(e,t,n){var r,i,s;return r=n.orderItemRegistry,i=n.itemPriceRegistry,e instanceof Array&&(e=e[0]),e=e.map(function(e){var n=e.renderedProductId,o,u,a,f,l={};return l.sourceProductId=e.sourceProductId,l.productType=e.productType,l.productTitle=e.productTitle,l.quantity=e.quantity,l.cost=e.costProductUnit,l.orderId=t,e.productPrice&&(a=e.productPrice,s={priceBase:a.priceBase,countPagesBase:a.countPagesBase,countPagesExtra:a.countPagesExtra,pricePerPage:a.pricePerPage,pricePagesExtra:a.pricePagesExtra,priceTotal:a.priceTotal},a.shipping&&(f=a.shipping,f.standardShipping&&(s.standardShippingBase=f.standardShipping.priceShippingBase,s.standardShippingExtra=f.standardShipping.priceShippingExtra),f.expressShipping&&(s.expressShippingBase=f.expressShipping.priceShippingBase,s.expressShippingExtra=f.expressShipping.priceShippingExtra)),i.exists(n)?(o=i.proxy(n),o.setValues(s)):(s.id=n,o=i.add(s))),e.product&&e.product.skuId&&(l.skuId=e.product.skuId),l.price=o,r.exists(n)?(u=r.proxy(n),u.setValues(l),u):(l.id=n,r.add(l))}),e}function f(e,t){var n,r,i,s,o;o={},n=t.orderRegistry,e.orderId&&(e.id=e.orderId);if(e.couponMetadata&&!e.couponMetadata.isValidCoupon)throw s=new Error(e.couponMetadata.invalidReason),s.name="CouponInvalidError",s;return e.coupons&&(o.coupon=this.parseCoupons(e.coupons.coupon,e.couponMetadata,e.orderId,t),i=o.coupon.getValue("discounts").getList()[0],i&&i.getValue("discountType")==="percent"&&parseInt(i.getValue("discountValue"),10)===100?o.isFreeOrder=1:o.isFreeOrder=0),e.item&&(o.items=this.parseItems(e.item,e.id,t)),o.orderId=e.orderId,o.statusOrder=e.statusOrder,o.statusPrint=e.statusPrint,o.statusPayment=e.statusPayment,o.paymentMethodId=e.paymentMethodId,o.bookPreviewPdf=e.bookPreviewPdf,o.userId=e.userId,o.trackingNum=e.trackingNum,o.trackingUrl=e.trackingUrl,o.costTotal=parseFloat(e.costTotal)||0,o.costProducts=parseFloat(e.costProducts)||0,o.costShipping=e.costShipping||0,o.costDiscount=e.costDiscount||0,o.costTax=e.costTax,o.isCouponApplied=e.isCouponApplied,o.shippingType=e.shippingType||e.shipMethod||"standard_shipping",o.dateCreate=e.dateCreate,e.countryCode&&(o.countryCode=e.countryCode),n.exists(e.orderId)?(r=n.proxy(e.orderId),r.setValues(o),r):(o.id=e.orderId,n.add(o))}function l(t,n){var r=t,i=n.pageModelRegistry,s=n.bookModelRegistry,o=n.pagePhotoModelRegistry,u=n.photoModelRegistry,a=n.personRegistry,f=n.photoEngagementRegistry,l=n.photoStatsRegistry,c,h=[];if(r)return t={id:r.id,owner:r.owner,title:r.title,coverPhotoId:r.coverPageId,totalPhotos:0,price:r.price,created:r.dateCreate},r.page&&e.Array(r.page).forEach(function(n){var r=[],s;n.photo&&e.Array(n.photo).forEach(function(i){var s,h,p;e.Lang.isNumber(parseInt(i.id,10))&&(n.id=String(n.id).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),p=n.id+"_"+i.position,s={id:p,bookId:t.id,position:i.position,cropX:i.cropX/100,cropY:i.cropY/100,cropW:i.cropW/100,cropH:i.cropH/100,invalidForPrintReason:i.invalidForPrintReason,isInvalidForPrint:i.isInvalidForPrint},h=e.APIHelper.response.parsePhotos({photos:[i],personModelRegistry:a,photoModelRegistry:u,photoEngagementModelRegistry:f,photoStatsModelRegistry:l})[0],s.photo=h,c=s.id,o.exists(c)?(delete s.id,o.setValues(c,s)):o.add(s),r.push(o.proxy(c)))}),s=e.APIHelper.response.parsePage(n),s.bookId=t.id,s.pagePhotos=r,c=s.id,i.exists(c)?(delete s.id,i.setValues(c,s),n=i.proxy(c)):n=i.add(s),h.push(c),t.totalPhotos=t.totalPhotos+r.length,t.coverPage||(t.coverPage=n)}),t.pageOrder=h,s.exists(t.id)?s.setValues(t.id,{title:t.title,pageOrder:t.pageOrder,totalPhotos:t.totalPhotos,coverPage:t.coverPage}):s.add(t),t}var n,r,i,s;n={1:"Flickr Pro",2:"Flickr Pro",3:"Flickr Pro",4:"Ad Free",6:"Ad Free",7:"Flickr Pro",8:"Flickr Pro"},r={1:"3 months",2:"1 year",3:"2 years",4:"1 year",6:"1 month",7:"1 month",8:"1 year"},i={1:"Created",2:"Pending",3:"Submitted",4:"Accepted",5:"Packaged",6:"Shipped",7:"Voided",99:"Cancelled",101:"Submitted"},s={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},e.ProductsAPIHelper={parseOrder:f,parseCoupons:u,parseItems:a,parseBook:l,parseSubscriptionCoupon:o}},"@VERSION@",{requires:[]});
YUI.add("flickr-products-books-editPage-updater",function(e,t){"use strict";function n(n,r){var i={};return i.page_id=n.pageId,i.book_id=n.bookId,n.templateId&&(i.template_id=n.templateId),n.backgroundColor&&(i.background_color=n.backgroundColor),r.callAPI("flickr.products.books.editPage",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-editPage"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-products-books-getPage-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),book_id:t.bookId,page_id:t.id};return t.page=t.page||1,t.perPage=t.perPage||100,n}function r(e,t){var n=e[0],r=e[1],i={id:t.id,photo:[]},s=[],o=!1,u=!1;r.exists(t.id)&&(s=r.getValue(t.id,"photoList").getList(),o=s.hasMinBoundary?s.hasMinBoundary():!1,u=s.hasMaxBoundary?s.hasMaxBoundary():!1),i.pageNumber=n.pageNumber,i.template=parseInt(n.template,10),i.countPhotos=n.countPhotos,i.photo=n.photo,i.backgroundColor=n.backgroundColor,r.exists(t.id)?r.setValue(t.id,"photoList",i.photoList):r.add(i)}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.books.getPage",this._processParams(n)),r.getModelRegistry("page-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-books-getPage"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models"]});
YUI.add("flickr-products-books-setPagePhoto-updater",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=r.page,l=[],c,h;f&&(f.photo&&e.Array(f.photo).forEach(function(t){var r,i,c,p,d;d=f.id+"_"+t.position,r={id:d,bookId:n.bookId,position:t.position,cropX:t.cropX/100,cropY:t.cropY/100,cropW:t.cropW/100,cropH:t.cropH/100,invalidForPrintReason:t.invalidForPrintReason,isInvalidForPrint:t.isInvalidForPrint},i=e.APIHelper.response.parsePhoto(t),c=i.owner,p=i.engagement,h=c.id,u.exists(h)?(delete c.id,u.setValues(h,c)):u.add(c),i.owner=u.proxy(h),h=p.id,a.exists(h)?(delete p.id,a.setValues(h,p)):a.add(p),i.engagement=a.proxy(h),h=i.id,o.exists(h)?(delete i.id,o.setValues(h,i)):o.add(i),r.photo=o.proxy(h),h=r.id,s.exists(h)?(delete r.id,s.setValues(h,r)):s.add(r),l.push(s.proxy(h))}),c=e.APIHelper.response.parsePage(f),c.pagePhotos=l,h=c.id,i.exists(h)?(delete c.id,i.setValues(h,c)):i.add(c))}function r(r,i){var s={};return s.page_id=r.pageId,s.book_id=r.bookId,s.position=r.position,s.photo_id=r.photoId,s.crop_x=Math.round(Math.abs(r.cropX*100)),s.crop_y=Math.round(Math.abs(r.cropY*100)),s.crop_w=Math.round(Math.abs(r.cropW*100)),s.crop_h=Math.round(Math.abs(r.cropH*100)),s.extras=e.APIHelper.request.getRebootPhotoExtras(),e.Promise.all([i.callAPI("flickr.products.books.setPagePhoto",s),i.getModelRegistry("page-models"),i.getModelRegistry("book-page-photo-models"),i.getModelRegistry("photo-models"),i.getModelRegistry("person-models"),i.getModelRegistry("photo-engagement-models")]).then(function(e){return n(e,r)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-setPagePhoto"]={run:r}},"@VERSION@",{requires:["flickr-promise"],optional:["page-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("book-page-photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(e){},create:function(t){return e.ModelUpdaters["flickr-products-books-setPagePhoto"].run({create:!0,pageId:t.pageId,bookId:t.bookId,position:1,photoId:t.photoId,template:2,cropX:0,cropY:0,cropW:0,cropH:0},this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)}},attributes:{bookId:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photo:{isModel:!0},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},position:{defaultFn:function(){return 1},getter:function(e){return parseInt(e,10)||1},defaultValue:1},isLowQuality:{defaultFn:function(){return 0}},invalidForPrintReason:{},isInvalidForPrint:{defaultFn:function(){return 0}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-setPagePhoto-updater"]});
YUI.add("flickr-products-books-updateBook-updater",function(e,t){"use strict";function n(t,n){return e.batch(n.getModel("book-models",t),n.getModelRegistry("page-models")).then(function(e){var t,r={},i,s=e[0],o=e[1];return t={id:""+s.id,owner:n.getViewer().nsid,title:s.getValue("title")},i=s.getValue("pageOrder"),t.count_pages=i.length-1,i.forEach(function(e,t){var n,i={},s,u;s=o.proxy(e),n={id:s.id,page_number:s.getValue("pageNumber")+"",count_photos:s.getValue("countPhotos")+"",template:s.getValue("template")+"",background_color:s.getValue("backgroundColor")},u=s.getValue("pagePhotos").getList(),u=u.forEach(function(e,t){var n;e.getValue("photo")&&(n={id:e.getValue("photo").id,position:t+1+"",crop_x:e.getValue("cropX")*100+"",crop_y:e.getValue("cropY")*100+"",crop_w:e.getValue("cropW")*100+"",crop_h:e.getValue("cropH")*100+"",low_quality:e.getValue("isLowQuality"),is_invalid_for_print:e.getValue("isInvalidForPrint")},i[t+1]=n)}),n.photos=i,r[t]=n}),t.pages=r,t})}function r(n,r,i){var s=this;return this.serialize(n,r).then(function(i){return r.callAPI("flickr.products.books.updateBook",{book:JSON.stringify(i)}).then(function(t){if(t[0]&&t[0].badPhotos)e.fire("bookUpdater:failure",{badPhotos:t[0].badPhotos});else if(s.pendingUpdate)return s.pendingUpdate=!1,s.startNextUpdate(n,r)},function(e){throw s.pendingUpdate&&(s.pendingUpdate=!1),e}).then(null,e.FetcherErrorLogger(t))})}function i(){return this.updateInFlight=null,!0}function s(e,t){return this.updateInFlight=this.callAPI(e,t).then(this.clearUpdateInFlight.bind(this),this.clearUpdateInFlight.bind(this)),this.updateInFlight}function o(e,t){return this.pendingUpdate=null,this.startUpdate(e,t)}function u(e,t){var n=e.bookId;return this.pendingUpdate?this.updateInFlight:this.updateInFlight?(this.pendingUpdate=!0,this.updateInFlight):this.startUpdate(n,t)}e.namespace("ModelUpdaters")["flickr-products-books-updateBook"]={run:u,serialize:n,callAPI:r,clearUpdateInFlight:i,startUpdate:s,startNextUpdate:o}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["page-models","book-models","book-page-photo-models"]});
YUI.add("api-products-books-helper",function(e){function t(t,n,r,i){var s=t.book,o,u,a=[];s&&(u={id:s.id,owner:s.owner,title:s.title,coverPhotoId:s.coverPhotoId},s.page&&e.Array(s.page).forEach(function(t){n.exists(t.id)?o=e.APIHelper.response.parsePage(t):n.add(e.APIHelper.response.parsePage(t)),a.push(n.proxy(t.id))}),u.pages=a,r.exists(u.id)?r.setValues(u.id,{title:u.title,pages:u.pages,coverPhotoId:u.coverPhotoId}):r.add(u))}e.APIProductsBooksHelper={processDefaultResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper","api-products-books-helper"],optional:["page-models","book-models"]});
YUI.add("flickr-products-books-editBook-updater",function(e,t){"use strict";function n(n,r){var i={};return i.book_id=n.bookId,i.title=n.title,e.Promise.all([r.callAPI("flickr.products.books.editBook",i),r.getModelRegistry("book-models")]).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-products-books-editBook"]={run:n}},"@VERSION@",{requires:["flickr-promise","api-helper","api-products-books-helper"],optional:["page-models","book-models"]});
YUI.add("flickr-products-books-creator",function(e,t){"use strict";function n(t){var n={};return t=t||{},n=t,n.cacheBust=Date.now(),n.extras=e.APIHelper.request.getRebootPhotoExtras(),n}function r(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.books.create",this._processParams(n)),pageModelRegistry:r.getModelRegistry("page-models"),bookModelRegistry:r.getModelRegistry("book-models"),pagePhotoModelRegistry:r.getModelRegistry("book-page-photo-models"),photoModelRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models")})).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-products-books-creator"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books"].run(t,this.appContext)},update:function(t,n){return"title"in n?e.ModelUpdaters["flickr-products-books-editBook"].run({bookId:t,title:n.title.newVal},this.appContext):e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:t},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-creator"].run(t,this.appContext)}},movePage:function(e,t,n,r){var i,s,o,u;return i=this.getValue(e,"pageOrder"),s=i.length,t<s&&n<s&&(r?u=i.splice(t,2):u=i.splice(t,1)[0],o=[n,0].concat(u),Array.prototype.splice.apply(i,o)),this.setValue(e,"pageOrder",i),i},addPage:function(e,t,n){var r,i;return r=this.getValue(e,"pageOrder"),i=r.length,n<=i&&r.splice(n+1,0,t),this.setValue(e,"pageOrder",r),r},removePage:function(e,t){var n,r,i,s;return n=this.getValue(e,"pageOrder"),s=n.length,r=n.indexOf(t),r<s&&(i=n.splice(r,1),this.setValue(e,"pageOrder",n)),n},attributes:{title:{},owner:{},pageOrder:{},coverPage:{isModel:!0},totalPhotos:{},price:{},lastPageViewed:{},created:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater","flickr-products-books-creator"]});
YUI.add("flickr-products-books-addPage-creator",function(e,t){"use strict";function n(t){var n={book_id:t.bookId};return t.photoIds&&(n.photo_ids=t.photoIds.join(","),n.extras=e.APIHelper.request.getRebootPhotoExtras()),e.Lang.isNumber(t.templateId)&&(n.template_id=t.templateId),t.backgroundColor&&(n.background_color=t.backgroundColor),n}function r(t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=t[4],f=t[5],l=t[6],c=[],h,p=i.page,d,v;return p.photo&&e.Array(p.photo).forEach(function(t){var r,i,s,f,h;h=p.id+"_"+t.position,r={id:h,bookId:n.bookId,position:t.position,cropX:t.cropX/100,cropY:t.cropY/100,cropW:t.cropW/100,cropH:t.cropH/100,invalidForPrintReason:t.invalidForPrintReason,isInvalidForPrint:t.isInvalidForPrint},i=e.APIHelper.response.parsePhoto(t),s=i.owner,f=i.engagement,d=s.id,a.exists(d)?(delete s.id,a.setValues(d,s)):a.add(s),i.owner=a.proxy(d),d=f.id,l.exists(d)?(delete f.id,l.setValues(d,f)):l.add(f),i.engagement=l.proxy(d),d=i.id,u.exists(d)?(delete i.id,u.setValues(d,i)):u.add(i),r.photo=u.proxy(d),d=r.id,o.exists(d)?(delete r.id,o.setValues(d,r)):o.add(r),c.push(o.proxy(d))}),v=e.APIHelper.response.parsePage(p),v.pagePhotos=c,v.bookId=n.bookId,d=v.id,s.exists(d)?(delete v.id,s.setValues(d,v),h=s.proxy(d)):h=s.add(v),f.proxy(n.bookId).getValue("pages").appendToList(h),h}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.books.addPage",this._processParams(n)),r.getModelRegistry("page-models"),r.getModelRegistry("book-page-photo-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("book-models"),r.getModelRegistry("photo-engagement-models")]).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-products-books-addPage"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("flickr-products-books-removePage-deletor",function(e,t){"use strict";function n(e,t){var n=e[1],r=e[0],i=n.book,s;i&&(s={id:i.id,price:i.price},r.exists(s.id)&&r.setValues(s.id,{price:s.price}))}function r(n,r,i){var s={},o=this;return s.page_id=n,s.book_id=r,e.Promise.all([i.getModelRegistry("book-models"),i.callAPI("flickr.products.books.removePage",s)]).then(function(e){return o._processResponse(e)},e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-products-books-removePage"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("page-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-books-getPage"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},create:function(t){return e.ModelCreators["flickr-products-books-addPage"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-products-books-removePage"].run(t,this.getValue(t,"bookId"),this.appContext)}},forceUpdate:function(t){return e.ModelUpdaters["flickr-products-books-updateBook"].run({bookId:this.getValue(t,"bookId")},this.appContext)},attributes:{bookId:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},backgroundColor:{defaultValue:"255,255,255"},pageNumber:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},template:{getter:function(e){return parseInt(e,10)},validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotos:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},pagePhotos:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-products-books-editPage-updater","flickr-products-books-getPage-fetcher","flickr-products-books-addPage-creator","flickr-products-books-removePage-deletor","flickr-model-registry","flickr-promise"]});
YUI.add("flickr-products-books-fetcher",function(e,t){"use strict";function n(t){t.page=t.page||1,t.perPage=t.perPage||100;var n;return n={book_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()},n}function r(t,n){var r,i;return r={pageModelRegistry:t.pageModelRegistry,bookModelRegistry:t.bookModelRegistry,pagePhotoModelRegistry:t.pagePhotoModelRegistry,photoModelRegistry:t.photoModelRegistry,personRegistry:t.personRegistry,photoEngagementRegistry:t.photoEngagementRegistry,photoStatsRegistry:t.photoStatsRegistry},i=e.ProductsAPIHelper.parseBook(t.response.book,r),i}function i(n,r){var i=this;return(new e.FlickrPromise({response:r.callAPI("flickr.products.books.getBook",this._processParams(n)),pageModelRegistry:r.getModelRegistry("page-models"),bookModelRegistry:r.getModelRegistry("book-models"),pagePhotoModelRegistry:r.getModelRegistry("book-page-photo-models"),photoModelRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models")})).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-books"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper","products-api-helper"],optional:["page-models","book-models","book-page-photo-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("basic-book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{title:{},owner:{},coverPhoto:{isModel:!0},coverPhotoDeleted:{defaultFn:function(){return!1}},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},totalPages:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater"]});
YUI.add("flickr-creations-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=[],d=[],v=[];return r&&r.stat==="ok"&&(p=Object.keys(r.wallart_ids).map(function(e){return r.wallart_ids[e]}),e.Array.each(p,function(t,n){if(t.photoSource===2)return;var r,i,s,u=[],p=!1,v,m,g,y={};r=a.addOrUpdate({id:t.owner}),t.photo.id?(y={photos:[t.photo],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c,photoCurationModelRegistry:h},t.photo.ownerId&&(y.ownerID=t.photo.ownerId),i=e.APIHelper.response.parsePhotos(y)[0]):p=!0,t.orders&&typeof t.orders=="object"&&(s=Object.keys(t.orders).map(function(e){return t.orders[e]}),e.Array.each(s,function(e){u.push({orderId:e.orderId,orderStatus:e.order.statusOrder,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate})})),t.skuId.substr(-2)==="CC"?(v=t.skuId.slice(0,-3),m=!0):t.skuId.substr(-2)==="MK"?(v=t.skuId.slice(0,-3),g=!0):v=t.skuId,d.push(o.addOrUpdate({id:t.wallartId,owner:r,photo:i,photoDeleted:p,skuId:v,isCC:m,isMK:g,orientation:t.orientation,price:t.price,cropW:t.photo.cropW,cropH:t.photo.cropH,cropX:t.photo.cropX,cropY:t.photo.cropY,isEditable:t.isEditable,isLowQuality:t.isLowQuality,created:t.dateCreate,updated:t.dateUpdate,orders:u,photoSource:t.photoSource}))})),i&&i.stat==="ok"&&e.Array.each(i.books.book,function(t,n){var r=!1,i,s;i=a.addOrUpdate({id:t.owner}),t.coverPhoto.id?s=e.APIHelper.response.parsePhotos({photos:[t.coverPhoto],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c})[0]:r=!0,v.push(u.addOrUpdate({id:t.id,title:t.title,owner:i,coverPhoto:s,coverPhotoDeleted:r,totalPages:t.countPages,created:t.dateCreate,updated:t.dateUpdate,cropW:t.coverPhoto.cropW/100,cropH:t.coverPhoto.cropH/100,cropX:t.coverPhoto.cropX/100,cropY:t.coverPhoto.cropY/100}))}),s.addOrUpdate({id:n.id,wallarts:d,books:v}),{wallarts:d,books:v}}function i(n,r){var i=this,s=this._processParams(n);return e.Promise.all([r.callAPI("flickr.products.wallart.getList",s,!0),r.callAPI("flickr.products.books.getList",s,!0),r.getModelRegistry("creations-models"),r.getModelRegistry("wallart-models"),r.getModelRegistry("basic-book-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-creations"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["creations-models","wallart-models","basic-book-models","person-models","photo-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("creations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-creations"].run(t,this.appContext)}},removeCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").remove(e)}),n.books&&e.Array.each(n.books,function(e,n){r.getValue(t,"books").remove(e)})},appendCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").unshift(e)})},attributes:{wallarts:{isCollection:!0},books:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-promise","model-proxy","flickr-model-registry","flickr-creations-fetcher"],optional:["wallart-models","basic-book-models"]});
YUI.add("flickr-products-wallart-create-creator",function(e,t){"use strict";function r(e){var t={};return e=e||{},t.photo_id=e.photoId,t.sku_id=e.skuId,t}function i(e,t,r){var i=e[0],s=e[1],o=e[2],u=e[3],a=t.nsid,f,l,c,h,p=!1,d=!1,v=e[4],m,g;return i?(f=i.wallart,c=o.exists(a)?o.proxy(a):o.add({id:a}),l=u.exists(t.photoId)?u.proxy(t.photoId):u.add({id:t.photoId}),f.skuId.substr(-2)==="CC"?(h=f.skuId.slice(0,-3),p=!0):f.skuId.substr(-2)==="MK"?(h=f.skuId.slice(0,-3),d=!0):h=f.skuId,s.exists(f.wallartId)?(s.setValues(f.wallartId,{owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,photoSource:f.photoSource}),g=s.proxy(f.wallartId)):g=s.add({id:f.wallartId,owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,created:f.dateCreate,photoSource:f.photoSource}),v.exists(a)&&(m=v.proxy(a),m.appendCreations({wallarts:[s.proxy(f.wallartId)]}))):(n.warn("No API response?"),g=this),g}function s(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.create",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("creations-models")]).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}var n=require("lib/flog")(t);e.namespace("ModelCreators")["flickr-products-wallart-create"]={run:s,_processParams:r,_processResponse:i}},"@VERSION@",{requires:["flickr-promise","wallart-models"],optional:["person-models","photo-models","creations-models"]});
