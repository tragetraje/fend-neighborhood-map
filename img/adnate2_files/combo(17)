YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","overflow-helper","url"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(t!=null?t:{},t!=null?t["photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" no-click"},3:function(e,t,n,r,i){return" is-hidden"},5:function(e,t,n,r,i){return" is-video"},7:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-url"]||(t!=null?t["prev-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-url",hash:{},data:i}):s))},9:function(e,t,n,r,i){return"#"},11:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-title"]||(t!=null?t["prev-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-title",hash:{},data:i}):s))},13:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-url"]||(t!=null?t["next-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-url",hash:{},data:i}):s))},15:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-title"]||(t!=null?t["next-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-title",hash:{},data:i}):s))},17:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return((s=n["if"].call(o,t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-toggle-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["people-notes-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"},18:function(e,t,n,r,i){return'	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<a class="navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(o,t!=null?t["photo-well-media-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<a class="navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n'+((s=n.unless.call(o,t!=null?t["is-ad"]:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,r,i){return"	Please continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+((s=n["if"].call(t!=null?t:{},t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"<br>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<form action="//'+f((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s===a?s.call(o,{name:"host",hash:{},data:i}):s))+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="'+f((s=(s=n["redirect-url"]||(t!=null?t["redirect-url"]:t))!=null?s:u,typeof s===a?s.call(o,{name:"redirect-url",hash:{},data:i}):s))+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return'	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:i}))+"</h2>\n"+((s=n["if"].call(o,t!=null?t.isSignedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:i}))+"<br />"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:i}))+"</p>\n\n"+((s=n.unless.call(o,t!=null?t.isMinor:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},3:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"					<p><button class='ui-button'><span>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:i}))+"</span></button></p>\n					<p>"+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:i}))+"</p>\n"},5:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:i}))+' <a href="//'+a((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"host",hash:{},data:i}):s))+'/signin/" data-track="photoWellSignInClick">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a></p>\n"},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"\n"+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},8:function(e,t,n,r,i){var s;return'		<a class="ad-wrapper" href="'+e.escapeExpression(e.lambda((s=t!=null?t.ad:t)!=null?s.clickUrl:s,t))+'">\n'},10:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPending:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(11,i,0),data:i}))!=null?s:""},11:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'			<div class="videoplayer main-photo" style="width:'+l((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===f?o.call(u,{name:"width",hash:{},data:i}):o))+"px; height:"+l((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===f?o.call(u,{name:"height",hash:{},data:i}):o))+'px;">'+((s=n["if"].call(u,t!=null?t.isHTML5Video:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))!=null?s:"")+"</div>\n"},12:function(e,t,n,r,i){var s;return'<video id="video_1" poster="'+e.escapeExpression((s=(s=n.src||(t!=null?t.src:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"src",hash:{},data:i}):s))+'" class="video-js vjs-big-play-centered inherit-size"></video>'},14:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l="function";return'\n			<div class="facade-of-protection-neue '+((s=n["if"].call(u,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["zoom-view"]:t,{name:"outlet",hash:{},data:i}))+'\n			</div>\n\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===l?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="low-res-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<noscript>\n				<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			</noscript>\n'},15:function(e,t,n,r,i){return"is-video"},17:function(e,t,n,r,i){var s;return'			<span class="ad-info">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{brand:(s=t!=null?t.ad:t)!=null?s.brand:s,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:i}))+"</span>\n		</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,
n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e,t){var n=require("lib/flog")(t),r=500,i=500,s=100,o;o={photo:{render:function(){var t=this,n=this.get("photo"),r,i,o=new Date,u="";return t.preloadImage&&(t.preloadImage.onload=null),r=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(n.getValue("title").trim()===""?u=this.intlMessage({intlName:"common.UNTITLED"}):u=n.getValue("title"),u+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:i.url,highResSrc:r.url,imgAltText:u,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",r),YUI.Env.isServer?(this.serverWidth=r.width,this.serverHeight=r.height):n.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0;var n,i="photoPageShowedSize",u="\u00f8";try{n=/(?:_([a-z]))?\.jpg/.exec(r.url),n&&n[1]&&(u=n[1])}catch(a){}finally{i+=String(u).toUpperCase()}e.rapidTracker.beacon(this.name,i);var f=t.get("container").one(".low-res-photo"),l=t.get("container").one(".main-photo"),c=new Date-o,h;c<s?(l.removeClass("is-hidden").show(),f.hide()):(l.setStyles({position:"absolute",left:0,top:0,opacity:0}),l.removeClass("is-hidden"),h=function(){l.removeAttribute("style"),f.hide()},e.UA.ie?h():e.use("transition",function(e){l.transition({duration:.25,opacity:1},h)}))},t.preloadImage.src=r.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.appContext.flipper.isFlipped("enable-html5-video-2016"),n=this.getPhotoForDisplay({excludeSizes:[]});return!this.player||e.getValue("isVideoPending")?(this.setContainerWithTemplate("photo-well-media",{width:n.width,height:n.height,src:n.url,needsInterstitial:e.getValue("needsInterstitial"),isVideo:e.getValue("isVideo"),isHTML5Video:t,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",n),this):(e.getValue("isVideoPending")||(this.player.dimension&&t?(this.player.dimension("width",n.width),this.player.dimension("height",n.height)):this.player.resize(n.width,n.height)),this)}},ad:{render:function(){var e,t;return this.adJSON?e=this.adJSON:(e=this.appContext.adManager.getAdJSON(),this.adJSON=e),t=this.getAdSize(e),this.setContainerWithTemplate("photo-well-ad",{width:t.width,height:t.height,src:e.url,clickUrl:e.clickUrl,brand:e.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(n){t.set("photo",n);if(n.getValue("isVideo"))return new e.Promise(function(t,n){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?o.ad.render.call(this):o[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var r=this,i=this.get("personPreferences"),s=this.get("photo"),o=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),i.setValue("safeSearch",o),i.registry.remoteUpdate(r.appContext.auth.user.nsid).then(function(e){var t=s.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){s.registry.getValue(e,"safetyLevel")<=i.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),r.buildContainer()},function(e){n.error({err:e}),r.onError(r.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("isVideo")&&!this.get("photo").getValue("isVideoPending")&&(t.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,autoplay:!0,loop:!0,controlBar:{fullscreenToggle:!1}}),t.player.init().then(function(){}),t.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=new 
e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"});n.show()},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,t=this.getPixelRatio(),n;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(n=this.get("container").ancestor(),n&&(e=n.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:t})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:i,right:r,width:parseInt(this.appContext.getCookie("photoPW"),10)||r,height:parseInt(this.appContext.getCookie("photoPH"),10)||i}),e.height*=t,e.width*=t,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-attribution",function(e,t){e.Intl.add("hermes/attribution","en-US",{FOLLOW:["Follow"],FOLLOWING:["Following"],ERROR_SETTING_FRIEND:["There was a problem setting your friend relationship"],ERROR_SETTING_FAMILY:["There was a ",{type:"number",valueName:"POPULATION",format:"integer"}," problem setting your family relationship"],FRIEND:["Friend"],FAMILY:["Family"],UNFOLLOW:["Unfollow"],GO_TO_PHOTOSTREAM:["Go to ","${name}","'s photostream"],BY_USER:["By: ","${user}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-head-meta",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'name="'},3:function(e,t,n,r,i){return'property="'},5:function(e,t,n,r,i){return'description="'+e.escapeExpression(e.lambda(t,t))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u,a=t!=null?t:{},f=n.helperMissing,l="function",c=e.escapeExpression,h="<meta "+((s=n["if"].call(a,t!=null?t.isName:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+c((o=(o=n.metaName||(t!=null?t.metaName:t))!=null?o:f,typeof o===l?o.call(a,{name:"metaName",hash:{},data:i}):o))+'" content="'+c((n.renderMetaInfo||t&&t.renderMetaInfo||f).call(a,t!=null?t.metaValue:t,{name:"renderMetaInfo",hash:{},data:i}))+'" ';return s=(o=(o=n.metaDescription||(t!=null?t.metaDescription:t))!=null?o:f,u={name:"metaDescription",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i},typeof o===l?o.call(a,u):o),n.metaDescription||(s=n.blockHelperMissing.call(t,s,u)),s!=null&&(h+=s),h+' data-dynamic="true">\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-link",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'id="'+e.escapeExpression((s=(s=n.id||(t!=null?t.id:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"id",hash:{},data:i}):s))+'"'},3:function(e,t,n,r,i){var s;return'rev="'+e.escapeExpression((s=(s=n.rev||(t!=null?t.rev:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rev",hash:{},data:i}):s))+'"'},5:function(e,t,n,r,i){var s;return'rel="'+e.escapeExpression((s=(s=n.rel||(t!=null?t.rel:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rel",hash:{},data:i}):s))+'"'},7:function(e,t,n,r,i){var s;return'type="'+e.escapeExpression((s=(s=n.type||(t!=null?t.type:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"type",hash:{},data:i}):s))+'"'},9:function(e,t,n,r,i){var s;return'media="'+e.escapeExpression((s=(s=n.media||(t!=null?t.media:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"media",hash:{},data:i}):s))+'"'},11:function(e,t,n,r,i){var s;return'href="'+e.escapeExpression((s=(s=n.href||(t!=null?t.href:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"href",hash:{},data:i}):s))+'"'},13:function(e,t,n,r,i){return'data-dynamic-added-by="'+e.escapeExpression((n.obfuscateInternals||t&&t.obfuscateInternals||n.helperMissing).call(t!=null?t:{},t!=null?t.addedBy:t,{name:"obfuscateInternals",hash:{},data:i}))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return"<link "+((s=n["if"].call(o,t!=null?t.id:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rev:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rel:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.type:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.media:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.href:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.addedBy:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))!=null?s:"")+' data-dynamic="true" />'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-link",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-breadcrumb",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<script type="application/ld+json">\n	{\n		"@context": "http://schema.org",\n		"@type": "BreadcrumbList",\n		"itemListElement": [\n			{\n				"@type": "ListItem",\n				"position": 1,\n				"item": {\n					"@id": "https://www.flickr.com/photos/'+f((s=(s=n.pathAliasOrNsid||(t!=null?t.pathAliasOrNsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAliasOrNsid",hash:{},data:i}):s))+'",\n					"name": "'+f((s=(s=n.displayName||(t!=null?t.displayName:t))!=null?s:u,typeof s===a?s.call(o,{name:"displayName",hash:{},data:i}):s))+'",\n					"image": "https://'+f((s=(s=n.avatarUrl||(t!=null?t.avatarUrl:t))!=null?s:u,typeof s===a?s.call(o,{name:"avatarUrl",hash:{},data:i}):s))+'"\n				}\n			}, {\n				"@type": "ListItem",\n				"position": 2,\n				"item": {\n					"@id": "https://www.flickr.com/photos/'+f((s=(s=n.pathAliasOrNsid||(t!=null?t.pathAliasOrNsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAliasOrNsid",hash:{},data:i}):s))+"/"+f((s=(s=n.photoId||(t!=null?t.photoId:t))!=null?s:u,typeof s===a?s.call(o,{name:"photoId",hash:{},data:i}):s))+'",\n					"name": "'+f((s=(s=n.title||(t!=null?t.title:t))!=null?s:u,typeof s===a?s.call(o,{name:"title",hash:{},data:i}):s))+'",\n					"image": "https://'+f((s=(s=n.photoPreview||(t!=null?t.photoPreview:t))!=null?s:u,typeof s===a?s.call(o,{name:"photoPreview",hash:{},data:i}):s))+'"\n				}\n			}\n		]\n	}\n</script>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-breadcrumb",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=n.getValue("owner"),i=r.getValue("buddyicon"),s=n.getValue("sizes"),o=this.get("photo-privacy"),u=e.url(),a=t.getFieldsForDisplay(),f="",l=this,c=[{id:"canonicalurl",rel:"canonical",href:u+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:u+"/services/oembed?url="+encodeURI(u+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:u+"/services/oembed?url="+encodeURI(u+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];a["al:ios:url"]||(a["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),f+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||""})+"\n";var h="noarchive";return o.getValue("isPublic")||(h+=", noindex"),f+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:h}),f+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:h}),Object.keys(a).forEach(function(e){typeof a[e]=="object"&&e==="pinterest"?f+=l.templates("head-meta")({metaName:e,noPin:!0,metaValue:a[e].nopin,metaDescription:a[e].reason,isName:!0})+"\n":e==="og:description"?f+=l.templates("head-meta")({metaName:e,metaValue:a[e]})+"\n":e==="title"?f+=l.templates("head-meta")({isName:!0,metaName:"title",metaValue:a[e]})+"\n":e==="keywords"?f+=l.templates("head-meta")({isName:!0,metaName:e,metaValue:a[e]})+"\n":e==="noindexfollow"?a[e]&&(a[e]>0||a[e]!=="")&&(f+=l.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",f+=l.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):f+=l.templates("head-meta")({metaName:e,metaValue:a[e]})+"\n"}),c.forEach(function(e){e.addedBy=l.name,f+=l.templates("head-link")(e)+"\n"}),f+=l.templates("head-breadcrumb")({pathAliasOrNsid:r.getValue("pathAlias")||r.getValue("id"),displayName:r.getValue("displayname"),avatarUrl:i.default,photoId:n.getValue("id"),title:n.getValue("title")||"Untitled",photoPreview:s.s.url}),this.set("headContainer",f),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link","hermes-template-head-breadcrumb"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta",function(e,t){e.Intl.add("hermes/meta","en-US",{PHOTOSTREAM:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"photo on Flickr!",other:"${#} photos on Flickr!"}}],PHOTOSTREAM_NO_PHOTOS:["Explore ","${username}","'s photos on Flickr!"],ALBUMS_LIST:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"album on Flickr!",other:"${#} albums on Flickr!"}}],ALBUMS_LIST_NO_ALBUMS:["Explore ","${username}","'s albums on Flickr!"],FAVORITES:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"favorites on Flickr!",other:"${#} favorites on Flickr!"}}],FAVORITES_NO_PHOTOS:["Explore ","${username}","'s favorites on Flickr!"],META_DESCRIPTION_BY_USER_ON_FLICKR:["By ","${username}"," on Flickr"],PHOTOSTREAM_ATOM_TITLE:["Flickr: ","${username}","'s Photostream Atom feed"],FAVORITES_ATOM_TITLE:["Flickr: ","${username}","'s Favorites Atom feed"],GROUP_POOL_ATOM_TITLE:["Flickr: ","${groupName}","'s Photos Atom feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr: ","${groupName}","'s Discussions Atom feed"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["scrappy-photo-page-enabled","is-real-fullscreen","enable-zoom"],dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t=this.subviews["photo-well-view"].get("container");return this.setContainerWithTemplate("photo-page-lightbox",{"photo-well-view":t}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","fletrics","ttfp-recorder-plugin","signin-helper","url"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("photo-well-scrappy-view",function(e,t){var n=require("lib/flog")(t),r=1,i=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.entryURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.isAd=!!t.ad,this.hideBackToLink=t.hideBackToLink||!1,this.publisherUrl=t.publisherUrl,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.numberOfPositionsToPreFetch=t.numberOfPositionsToPreFetch,this.numberOfPositionsToRefetchAt=t.numberOfPositionsToRefetchAt,this},additionalViewClasses:["centered-content"],subviewConfig:{"photo-well-media-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-notes-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-notes")}},"photo-engagement-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"context-slider-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-sidebar-toggle-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,neverShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},buildContainer:function(){var e=this,t="",n,r=0,i,s,o=".navigate-prev",u=".navigate-next",a,f,l,c,h,p;return this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),t=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),t=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&this.get("contextModel").getValue("photoContextList")&&(n=this.get("contextModel").getValue("photoContextList").getList(),n.length>2&&n.some(function(t){return r++,t.getValue("id")===e.photoId})&&(i=n.slice(r-2,r-1),s=n.slice(r,r+1),i&&i.length>0&&(a=e.setupNavLink(i[0],o,"previous"),i[0].getValue("owner")&&(i[0].getValue("title").trim()===""?l=e.intlMessage({intlName:"common.UNTITLED"}):l=i[0].getValue("title"),l+=" | "+e.intlMessage({intlName:"common.BY_USER",user:i[0].getValue("owner").getValue("username")}))),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"next"),s[0].getValue("owner")&&(s[0].getValue("title").trim()===""?c=e.intlMessage({intlName:"common.UNTITLED"}):c=s[0].getValue("title"),c+=" | "+e.intlMessage({intlName:"common.BY_USER",user:s[0].getValue("owner").getValue("username")}))))),h=this.getPhotoWellHeight(),p=h-70,this.setContainerWithTemplate("photo-well-scrappy",{"photo-well-media-view":this.subviews["photo-well-media-scrappy-view"]?this.subviews["photo-well-media-scrappy-view"].get("container"):"","context-slider-view":this.subviews["context-slider-scrappy-view"]?this.subviews["context-slider-scrappy-view"].get("container"):"","is-hidden":!a&&!f,"prev-is-not-clickable":!a,"next-is-not-clickable":!f,"prev-url":a,"next-url":f,"prev-title":l,"next-title":c,"is-ad":this.isAd,"attribution-view":t,height:h,navHeight:p,entryURL:this.entryURL,backToLabel:this.intlMessage({intlName:"photo-page-scrappy."+this.entryTypeIntlKey}),enableZoom:!0,hideBackToLink:this.hideBackToLink}),YUI.Env.isServer||(this.subviews["photo-well-media-scrappy-view"]&&this.subviews["photo-well-media-scrappy-view"].fire("parentViewEvent","photoWellResized"),this.subviews["photo-notes-scrappy-view"]&&this.subviews["photo-notes-scrappy-view"].fire("parentViewEvent","photoWellResized")),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-scrappy-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-scrappy-view"].serverHeight),this},loadState:function(){var t=this,r=[];return r.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&r.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(e){var r;if(e){r=e.attributeSearch(t.contextData.params);if(r&&r.length&&e.exists(r[0]))return t.appContext.getModel(t.contextData.modelName,r[0]).then(function(e){e&&t.set("contextModel",e)},function(e){return n.error("photo not found in context. Loading photostream instead.",{err:e}),t.loadPhotostreamContext()})}}).catch(function(){return"whatever"})),e.Promise.all(r)},buildHeadContainer:function(){var e=this.templates("photo-page-right-size-express")({photoWidth:this.get("photo").getLargestSize().width,photoHeight:this.get("photo").getLargestSize().height});return this.set("headContainer",e),this},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f=!0,l=this;s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){t&&f&&t.removeClass("is-hidden"),u&&f&&(r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(l.movingTimeout),clearTimeout(l.initialTimeout),f=!0,l.movingTimeout=setTimeout(function(){u&&i&&i.addClass("is-hidden")},s*2)},o))),this.contextData.modelName!=="photoList-models"&&this.contextData
.modelName!=="explore-models"&&(f=!1),l.initialTimeout=setTimeout(function(){f=!0,u&&f&&i&&i.addClass("is-hidden")},s*2)},activate:function(){var t=this,s=this.contextData,o=0,u,a,f,l,c,h=".navigate-prev",p=".navigate-next",d=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,t.appContext.getModel(s.modelName,s.params).then(function(e){t.set("contextModel",e)},function(n){if(!n.getModelFailure&&n.code!==1||s.modelName==="photostream-models")throw e.one(h).hide(),e.one(p).hide(),n;return t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})}).then(function(){var n=t.get("contextModel").getValue("photoContextList"),r=n.getList(),i,u,a,d;return r.length>2&&r.some(function(e){return o++,e.getValue("id")===t.photoId})&&(i=r.slice(o-2,o-1),u=r.slice(o,o+1),i&&i.length>0&&(a=t.setupNavLink(i[0],h,"previous"),a&&(t.updateNavLinks(t.get("container").one(h),f,l,a),t.get("container").one(h).removeClass("no-click"))),u&&u.length>0&&(d=t.setupNavLink(u[0],p,"next"),d&&(t.updateNavLinks(t.get("container").one(p),f,l,d),t.get("container").one(p).removeClass("no-click")))),c=e.merge(s.params,{photoId:t.photoId,numNext:t.numberOfPositionsToPreFetch,numPrev:t.numberOfPositionsToPreFetch,refetchAt:t.numberOfPositionsToRefetchAt}),n.getContext(c)}).then(function(s){function o(o,u){var a=t.get("container").one(o),c,h,p,d,v,m,g=s&&s[u]&&s[u].length,y;if(!a)return;if(!g){a.remove();return}a.removeClass("no-click"),c=t.setupNavLink(s[u][0],o,u);if(t.isAd)p=t.appContext.adManager.origin,u===p.arrow?(a.setAttribute("href",p.url),a.removeClass("is-hidden")):(a.setAttribute("href",c),a.removeClass("is-hidden"));else{t.updateNavLinks(a,f,l,c),h=t.subviews["photo-well-media-scrappy-view"].getCanvasSize();for(m=0;m<i;m++){if(!s[u][m])break;d=s[u][m].getSizeToFit(h,{includeSizes:["sq","q","t","s","n"]}),d&&d.url&&(v=new Image,v.src=d.url)}for(m=0;m<r;m++){if(!s[u][m])break;d=s[u][m].getSizeToFit(h),d&&d.url&&(v=new Image,y=e.guid(),e.LH&&e.LH.mark("mark_time_to_load_photo_only_start"+y),v.onload=function(){if(v.onloadFired)return;v.onloadFired=!0;try{e.LH.mark("mark_time_to_load_photo_only"+y);var t=e.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start"+y,endMark:"mark_time_to_load_photo_only"+y});!YUI.Env.isServer&&e.config.win.beaconError&&window.beaconError("time_to_load_photo_only",window.location.href,{duration:t.duration})}catch(r){n.warn("time to load photo: Missing start mark",{err:r})}}),v.src=d.url,v.complete&&(v.onloadFired=!0)}}}t.appContext.adManager.updateContext({prev:s.previous[0],current:t.get("photo"),next:s.next[0],type:t.contextData.modelName,entryURL:t.entryURL}),o(p,"next"),o(h,"previous"),t.animateNavigation(),t.isAd&&t.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.activate();throw e}).then(null,function(e){n.warn("There was a problem initializing the next/previous controls.",{err:e})}),d&&this.attachKeyEvent("down:37,75,39,74",t.handlePrevNextKeys.bind(t)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),u={":ad":t.setLinkAsAdFriendly},d&&!this.hideBackToLink&&this.attachKeyEvent("down:66",function(n){n.preventDefault(),e.rapidTracker.beacon(t.name,"backToContextKeyPress"),t.appContext.flapp.hasRoute(t.entryURL)?t.appContext.flapp.navigate(t.entryURL):e.config.win.location.href=t.entryURL}),t.registerEventHandler(e.on("resize",e.betterThrottle(function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()},16))),t.buildContainer(),t.attachEvents(u),this},getPhotoWellHeight:function(){var e=500,t=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight()-50,r=1,i=2.3,s=2.75,o=120,u=t/r+o,a=t/i+o,f=t/s,l;return n>u?l=t/r:n>a?l=n-o:n>f?l=n-o+o*(n-a)/(f-a):l=n,Math.max(e,Math.round(l))},setupNavLink:function(t,r,i){var s=this.get("container").one(r),o,u;if(!t){s.remove();return}o=t,u=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix")});if(!u||u==="#"){n.warn("Invalid next/prev URL",{url:u}),s.remove();return}return u},updateNavLinks:function(e,t,n,r){e.setAttribute("href",t+"//"+n+r),e.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},handlePrevNextKeys:function(t){var r=this,i,s,o,u=50;if(t.button===37||t.button===75)s=".navigate-prev",o="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)s=".navigate-next",o="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");s&&r.get("container").one(s)&&(t.preventDefault(),i=r.get("container").one(s).getAttribute("href"),i&&i!=="#"&&(r.keyboardNavigation&&r.keyboardNavigation.url&&i===r.keyboardNavigation.url&&(new Date).getTime()-r.keyboardNavigation.time<u?n.log("Ignoring duplicate keyboard navigation",{url:i}):(r.keyboardNavigation={url:i,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,o,i),r.appContext.flapp.navigate(i))))},handleContextMenu:function(e){e.preventDefault(),this.fire("parentViewEvent","rightClickPhoto")},onSubviewEvent:function(e,t){t&&t[0]==="photoWellResized"&&this.fire("parentViewEvent","photoWellResized")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well-scrappy","url-helper","better-throttle","hermes-template-photo-page-right-size-express"],optional:["photo-well-media-scrappy-view"
,"context-slider-scrappy-view","photo-engagement-view","photo-models","photo-route"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-sub-photo",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return'<div class="sub-photo-container centered-content">\n    '+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-left-view"]:t,{name:"outlet",hash:{},data:i}))+"\n    "+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-right-view"]:t,{name:"outlet",hash:{},data:i}))+'\n    <div style="clear: both;"></div>\n    '+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-keyboard-shortcuts-view"]:t,{name:"outlet",hash:{},data:i}))+"\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-left",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-title-desc-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-fave-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-comments-view"]:t,{name:"outlet",hash:{},data:i}))},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-left",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-attribution",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'	<a class="avatar person medium no-menu" data-person-nsid="'+f((s=(s=n.nsid||(t!=null?t.nsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"nsid",hash:{},data:i}):s))+'" style="background-image: url('+f((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:u,typeof s===a?s.call(o,{name:"buddyicon",hash:{},data:i}):s))+');" href="/photos/'+f((s=(s=n.pathAlias||(t!=null?t.pathAlias:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAlias",hash:{},data:i}):s))+'/"></a>\n'},3:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'	<div class="avatar person medium" data-person-nsid="'+f((s=(s=n.nsid||(t!=null?t.nsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"nsid",hash:{},data:i}):s))+'" style="background-image: url('+f((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:u,typeof s===a?s.call(o,{name:"buddyicon",hash:{},data:i}):s))+');"></div>\n'},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPro:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))!=null?s:""},6:function(e,t,n,r,i){return'		<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>\n'},8:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPro:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:""},9:function(e,t,n,r,i){return'			<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return((s=n["if"].call(u,t!=null?t.noMenu:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"\n"+((s=n.unless.call(u,t!=null?t.isAlbumView:t,{name:"unless",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n<div class="attribution-info">\n\n	<a href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" class="owner-name truncate" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{name:t!=null?t.displayname:t,intlName:"attribution.GO_TO_PHOTOSTREAM"},data:i}))+'" data-track="attributionNameClick">'+l((o=(o=n.displayname||(t!=null?t.displayname:t))!=null?o:a,typeof o===f?o.call(u,{name:"displayname",hash:{},data:i}):o))+'</a>\n	<a href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" class="owner-name-with-by truncate" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{name:t!=null?t.displayname:t,intlName:"attribution.GO_TO_PHOTOSTREAM"},data:i}))+'" data-track="attributionNameClick">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{user:t!=null?t.displayname:t,intlName:"attribution.BY_USER"},data:i}))+"</a>\n\n	"+l((n.outlet||t&&t.outlet||a).call(u,t!=null?t["follow-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+((s=n["if"].call(u,t!=null?t.isAlbumView:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/attribution",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-follow",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},2:function(e,t,n,r,i){return""},4:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},5:function(e,t,n,r,i){return"			<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:""},8:function(e,t,n,r,i){return'				<button class="follow is-following mini"><span class="drop-icon">\u25be</span></button>\n'},10:function(e,t,n,r,i){return'				<button class="follow mini"></button>\n'},12:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.isFluid:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(23,i,0),data:i}))!=null?s:"")+"	"+((s=n["if"].call(o,t!=null?t.curationEnrollmentStatus:t,{name:"if",hash:{},fn:e.program(30,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},13:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:""},14:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.program(17,i,0),data:i}))!=null?s:""},15:function(e,t,n,r,i){return"				<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},17:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.program(21,i,0),data:i}))!=null?s:""},18:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow is-following '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followingIntlKey:t},data:i}))+'<span class="drop-icon">\u25be</span></button>\n'},19:function(e,t,n,r,i){return"white"},21:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followIntlKey:t},data:i}))+"</button>\n"},23:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(24,i,0),data:i}))!=null?s:""},24:function(e,t,n,r,i){var s;return'			<span class="relationship">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(25,i,0),data:i}))!=null?s:"")+"			</span>\n"},25:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(26,i,0),inverse:e.program(28,i,0),data:i}))!=null?s:""},26:function(e,t,n,r,i){return"						<button class='unfluid follow is-following ui-button ui-button-icon ui-button-transparent ui-button-dropdown'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOWING"},data:i}))+"</span></button>\n"},28:function(e,t,n,r,i){return"						<button class='unfluid follow ui-button ui-button-icon'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOW"},data:i}))+"</span></button>\n"},30:function(e,t,n,r,i){var s;return"<h3 class='curation-enrollment-status'>["+e.escapeExpression((s=(s=n.curationEnrollmentStatus||(t!=null?t.curationEnrollmentStatus:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"curationEnrollmentStatus",hash:{},data:i}):s))+"]</h3>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isOnMobile:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/follow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-following-dropdown",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'			<label class = "checked">\n				<input type="checkbox" checked="checked" id="friend-checkbox" />\n'},3:function(e,t,n,r,i){return'			<label>\n				<input type="checkbox" id="friend-checkbox" />\n'},5:function(e,t,n,r,i){return'			<label class="checked">\n				<input type="checkbox" checked="checked" id="family-checkbox" />\n'},7:function(e,t,n,r,i){return'			<label>\n				<input type="checkbox" id="family-checkbox" />\n'},9:function(e,t,n,r,i){return'			<button class="follow unfollow">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNFOLLOW"},data:i}))+"</button>\n"},11:function(e,t,n,r,i){return'			<a href="#"><i class="ui-icon-tiny-unfollow"></i> '+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNFOLLOW"},data:i}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'<ul>\n	<li class="following-friend">\n'+((s=n["if"].call(o,t!=null?t.isFriend:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"			"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FRIEND"},data:i}))+'\n		</label>\n	</li>\n	<li class="following-family">\n'+((s=n["if"].call(o,t!=null?t.isFamily:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+"			"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FAMILY"},data:i}))+'\n		</label>\n	</li>\n	<li class="divider"></li>\n	<li class="following-unfollow">\n'+((s=n["if"].call(o,t!=null?t.isFluid:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.program(11,i,0),data:i}))!=null?s:"")+"	</li>\n</ul>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/following-dropdown",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("relationship-menu-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.relationship=t,e.nsid=e.nsid||t.id})},buildContainer:function(){return this.setContainerWithTemplate("following-dropdown",{isFriend:this.relationship.getValue("isFriend"),isFamily:this.relationship.getValue("isFamily"),isFluid:!0}),this},activate:function(){var e=this.get("container"),t=this;return this.relationship&&this.registerEventHandler(this.relationship.on("valuesChanged",function(){t.buildContainer()})),this.registerEventHandler(e.delegate("click",function(e){t.handleUnfollowClick(e)},".following-unfollow")),this.registerEventHandler(e.delegate("change",function(e){t.handleFriendChange(e)},".following-friend input")),this.registerEventHandler(e.delegate("change",function(e){t.handleFamilyChange(e)},".following-family input")),this},handleUnfollowClick:function(t){var r=this;t.preventDefault(),this.relationship.getValue("isContact")&&(this.relationship.registry.toggleFollowing(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.setValue("isContact",!0),r.buildContainer(),n.error({err:e})}),e.rapidTracker.beacon(this.name,"unfollowButtonClick"),this.fire("onUnfollow"))},handleFriendChange:function(t){var r=this;this.relationship.registry.toggleFriend(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.registry.toggleFriend(r.nsid),r.buildContainer(),r.onError(r.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:e})})},handleFamilyChange:function(t){var r=this;this.relationship.registry.toggleFamily(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.registry.toggleFamily(r.nsid),r.buildContainer(),r.onError(r.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:e})})}})},"@VERSION@",{requires:["promise","hermes-template-following-dropdown"],langBundles:["common","person"]});
YUI.add("follow-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("isActiveViewAgnostic",e.isActiveViewAgnostic),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.realFullscreen=!!e.realFullscreen,this.isFluid=e.isFluid,this.isOnDark=e.isOnDark,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.isOnMobile=e.isOnMobile,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.set("relationship",t),e.nsid=e.nsid||t.id})},buildContainer:function(){var e=this.get("relationship");return this.setContainerWithTemplate("follow",{showNoButton:e.getValue("isMe")||e.getValue("isIgnoredBy"),showUnblockButton:e.getValue("isIgnored"),showFollowingButton:e.getValue("isContact"),signedIn:this.appContext.getViewer().signedIn,isFluid:this.isFluid,isOnMobile:this.isOnMobile,isOnDark:this.isOnDark,followIntlKey:"common.FOLLOW",followingIntlKey:"common.FOLLOWING"}),this},activate:function(){var t=this,r=this.get("container"),i=this.get("relationship"),s,o;return this.isFluid&&!i.getValue("isMe")?this.registerEventHandler(r.delegate("click",function(r){e.rapidTracker.beacon(this.name,"followButtonClick"),s=r.target.hasClass("follow")?r.target:r.target.ancestor(".follow"),t.appContext.getViewer().signedIn?i.getValue("isIgnored")?(i.registry.toggleIgnore(t.nsid),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls(),i.registry.remoteUpdate(t.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){i.setValue("isIgnored",!0),t.buildContainer(),n.error({err:e})})):i.getValue("isContact")?(s.addClass("is-open"),o&&o.destroy(),o=new e.Views.FluidDroparound({appContext:t.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:140,height:130,observePageResize:!0,anchorOffsetHorizontal:6,anchorElement:s.one(".drop-icon"),subview:new e.Views["relationship-menu-view"]({nsid:t.nsid,pathAlias:t.pathAlias,disableRefreshOnRelationshipChange:t.disableRefreshOnRelationshipChange}),preferLeft:!0}),o.on("closeDroparound",function(){s.removeClass("is-open"),t.fire("subviewViewEvent","isClosed")}),o.show(),t.fire("subviewViewEvent","isOpen"),o.get("subview").on("onUnfollow",function(){o.close(),o.destroy(),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls()})):t.followPerson():t.signInAndRedirectToPerson()},"button.follow")):(r&&r.one("button")&&this.registerEventHandler(r.one("button").on("click",t.handleRelationshipClick,t)),this.get("relationship").getValue("isMe")||this.setupDropdown()),t},followPerson:function(){var t=this,r=this.get("relationship");r.getValue("isContact")||(r.registry.toggleFollowing(this.nsid),t.disableRefreshOnRelationshipChange?this.buildContainer():this.showBalls(),r.registry.remoteUpdate(this.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){t.hideBalls(),r.setValue("isContact",!1),t.buildContainer(),n.error({err:e})}))},showBalls:function(){this.balls||(this.balls=e.Node.create(this.templates("flickr-balls")({}))),this.get("container").append(this.balls),this.balls.show(),this.get("container").one(".follow").hide()},hideBalls:function(){this.balls&&(this.balls.remove(),this.get("container").one(".follow").show())},handleRelationshipClick:function(t){var n=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"followButtonClick");var r=this.get("relationship").getValue("isContact");this.appContext.getViewer().signedIn?r===!1?(this.followPerson(),e.rapidTracker.beacon(this.name,"photoAttributionFollowButtonClick")):n.isOnMobile?n.handleUnfollowClick(t):(n.relationshipDropDownDialog.toggle(),e.rapidTracker.beacon(this.name,"photoAttributionFollowMenuClick")):n.isOnMobile?e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:n.appContext.getUA().os,isWebview:n.appContext.getUA().isWebview,pageURL:"/photos/"+n.nsid,beacon:{name:"mpp_follow_signedout",section:"attribution-view"},viewName:n.name})}):n.signInAndRedirectToPerson()},handleFriendChange:function(t){var r=this;this.get("relationship").registry.toggleFriend(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFriend(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleFamilyChange:function(t){var r=this;this.get("relationship").registry.toggleFamily(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFamily(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleUnfollowClick:function(t){var r=this;t.preventDefault(),this.get("relationship").registry.toggleFollowing(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.isOnMobile||this.relationshipDropDownDialog.toggle(function(){this.toggleFollowingButton(t.target
.ancestor(".relationship").one("button"),this.get("relationship").getValue("isContact"))}.bind(this)),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").setValue("isContact",!0),this.toggleFollowingButton(t.target.ancestor("button"),!0),n.error({err:e})}.bind(this)),e.rapidTracker.beacon(this.name,"photoAttributionUnfollowButtonClick")},toggleFollowingButton:function(e,t){t?(e.setContent("<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>"),e.addClass("follow-anim").addClass("is-following"),setTimeout(function(){e.removeClass("follow-anim")},500),e.addClass("ui-button-dropdown")):(e.addClass("unfollow-anim").removeClass("is-following"),setTimeout(function(){e.removeClass("unfollow-anim")},500),e.one("span").setContent(this.intlMessage({intlName:"common.FOLLOW"})),e.removeClass("ui-button-dropdown"))},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1});n.show()},setupDropdown:function(){var t=this,n=this.get("container"),r,i=n.one(".relationship"),s,o=n.one(".relationship button");if(!i)return;s=this.templates("following-dropdown")({isFriend:this.get("relationship").getValue("isFriend"),isFamily:this.get("relationship").getValue("isFamily")}),e.use("dialog",function(){t.relationshipDropDownDialog=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".relationship"),positioning:!1,parent:t}),t.registerEventHandler(t.relationshipDropDownDialog.on("hide",function(e){o.removeClass("is-open")})),t.registerEventHandler(t.relationshipDropDownDialog.on("show",function(e){o.addClass("is-open")})),t.relationshipDropDownDialog.render(),r=t.relationshipDropDownDialog.get("container"),r.detach("click"),t.registerEventHandler(r.one(".following-unfollow").on("click",t.handleUnfollowClick,t)),t.registerEventHandler(r.one(".following-friend input").on("change",t.handleFriendChange,t)),t.registerEventHandler(r.one(".following-family input").on("change",t.handleFamilyChange,t))})},showSignUpModal:function(){var t=this;this.appContext.getModel("person-models",this.nsid).then(function(n){var r=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,i=t.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:n.getValue("displayname")}),s=n.getValue("buddyicon"),o;s.displayUrl=s.retina||s.large||s.medium||s.default,o=new e.Views.SignUpModal({appContext:t.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:s.displayUrl,signUpTitle:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:i,beaconPrefix:"follow"}),o.on("signUpClick",function(n){e.SigninHelper.signUpPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.on("signInClick",function(n){e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.show()})},signInAndRedirectToPerson:function(){var t=this,n=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,r=t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_MESSAGE"}),i=t.intlMessage({intlName:"person.SIGN_IN_AND_FOLLOW"}),s=t.intlMessage({intlName:"common.CANCEL"}),o;if(this.signedOutTest)return this.showSignUpModal();o=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),htmlMessage:r,actionButtonLabel:i,cancelButtonLabel:s}),o.on("actionClick",function(){e.rapidTracker.beacon(t.name,"followModalSigninClick"),e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:n})}),o.on("cancelClick",function(n){e.rapidTracker.beacon(t.name,"followModalCancelClick")}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-follow","promise","fluid-droparound-view","fluid-modal-view","signup-modal-view","hermes-template-following-dropdown","hermes-template-flickr-balls","relationship-menu-view","signin-helper"],optional:["person-models","person-relationship-models"],langBundles:["common","person"]});
YUI.add("attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=e.hideFollowView?e.hideFollowView:!1,this.isAlbumView=e.isAlbumView,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("person-models",t.nsid)]).then(function(e){t.set("owner",e[0])})},buildContainer:function(){var e=this.get("owner"),t=this.get("container"),n=e.getValue("pathAlias")||e.getValue("nsid"),r,i=this;return this.albumPhotoListLayoutStyle==="justified"&&t.addClass("justified-album-details-page"),r=e.getValue("buddyicon").large?e.getValue("buddyicon").large:e.getValue("buddyicon")["default"],this.setContainerWithTemplate("attribution",{isPro:i.appContext.flipper.isFlipped("enable-pro-badge")?e.getValue("isPro"):!1,pathAlias:n,buddyicon:r,nsid:e.getValue("nsid"),displayname:e.getValue("displayname"),realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView}),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution","promise","follow-view"],optional:["person-models"],langBundles:["attribution"]});
